<aura:component controller="FF_ProductController" implements="force:lightningQuickAction,flexipage:availableForAllPageTypes,force:hasRecordId,lightning:actionOverride" access="global" description="FF_EditProduct">
    <aura:attribute name="productFields" type="Product2" />
    <aura:attribute name="product" type="Product2" />
    <aura:attribute name="productError" type="String"/>
    <aura:attribute name="currentFileWrappers" type="Object[]"/>
    <aura:attribute name="fileWrappers" type="Object[]"/>
    <aura:attribute name="productFamilyPicklist" type="Object"/>
    <aura:attribute name="imagesToDelete" type="String[]"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <force:recordData aura:id="productEdit"
                      fields="Id,Name,IsActive,ProductCode,Description,Dimensions__c,Materials__c,Color__c,Family,RecordTypeId"
                      recordId="{!v.recordId}"
                      targetFields="{!v.productFields}"
                      targetError="{!v.productError}"
                      mode="EDIT"
    />
    <lightning:overlayLibrary aura:id="overlayLib"/>

    <c:FF_PicklistValues aura:id="familyPicklist" sObjectName="Product2" fieldName="Family" picklistValues="{!v.productFamilyPicklist}"/>

    <div style="display: flex; justify-content: center">
        <div style="margin: 0 auto;">
            <div class="slds-card" style="width: 60vw;" aura:id="editDialog" role="dialog" tabindex="-1" aria-labelledby="header43">
                <div class="slds-section__title slds-p-around_small">
                    Product Information
                </div>
                <div class="slds-p-around--small slds-grid slds-wrap ">
                    <lightning:input value="{!v.productFields.Name}" label="Product Name" required="true" class="slds-size--1-of-2 slds-p-horizontal_small" />
                    <lightning:input value="{!v.productFields.IsActive}" type="checkbox" variant="label-stacked" label="Active" class="slds-size--1-of-2 slds-p-horizontal_small" />
                    <lightning:input value="{!v.productFields.ProductCode}" label="Product Code" class="slds-size--1-of-2 slds-p-horizontal_small" />
                    <lightning:select value="{!v.productFields.Family}" label="Product Family" class="slds-size--1-of-2 slds-p-horizontal_small">
                        <aura:iteration items="{!v.productFamilyPicklist}" var="item">
                            <aura:if isTrue="{!v.productFields.Family == item }">
                                <option value="{!item}" selected="selected">{!item}</option>
                                <aura:set attribute="else">
                                    <option value="{!item}">{!item}</option>
                                </aura:set>
                            </aura:if>
                        </aura:iteration>
                    </lightning:select>
                    <lightning:input value="{!v.productFields.Description}" label="Product Description" class="slds-size--1-of-2 slds-p-horizontal_small"/>
                    <lightning:input value="{!v.productFields.Color__c}" label="Color" class="slds-size--1-of-2 slds-p-horizontal_small"/>
                    <lightning:input value="{!v.productFields.Dimensions__c}" label="Dimensions" class="slds-size--1-of-2 slds-p-horizontal_small"/>
                    <lightning:input value="{!v.productFields.Materials__c}" label="Materials" class="slds-size--1-of-2 slds-p-horizontal_small"/>

<!--                    <img class="preview" src="{!'/sfc/servlet.shepherd/version/download/' + v.detailImage1.Id}"/>-->

                    <div class="slds-size--1-of-1 slds-align_absolute-center slds-p-horizontal_small">
                        <lightning:input type="file" name="file" label="Add photos"
                                         accept="image/png, image/jpg, image/jpeg" multiple="true"
                                         onchange="{!c.handleUpload}"/>
                    </div>

                    <div class="slds-size--1-of-1 slds-p-horizontal_small">
                        <div class="slds-align_absolute-center">
                            <aura:iteration items="{!v.currentFileWrappers}" var="wrapper">
                                <div class="preview slds-box_border" style="margin: 10px; width: 200px;">
                                    <img class="preview slds-box_border" src="{!'/sfc/servlet.shepherd/version/download/' + wrapper.contentVersionId}"/>
                                    <div style="margin: 5px 0; display: flex; flex-wrap: wrap; justify-content: space-around;">
                                        <ui:inputCheckbox aura:id="checkbox"  value="{!wrapper.isMain}" label="Select main" name="{!index}" change="{!c.handleSetMain}" />
                                        <lightning:button value="{!wrapper}" label="Delete" onclick="{!c.handleDeleteCurrent}"/>
                                    </div>
                                </div>
                            </aura:iteration>
                            <aura:iteration items="{!v.fileWrappers}" var="fileWrapper" indexVar="index">
                                <div class="preview slds-box_border" style="margin: 10px; width: 200px;">
                                    <img class="preview" src="{!fileWrapper.filePreview}"/>
                                    <div style="margin: 5px 0; display: flex; flex-wrap: wrap; justify-content: space-around;">
                                        <ui:inputCheckbox aura:id="checkbox" value="{!fileWrapper.isMain}" label="Select main" name="{!index}" change="{!c.handleSetMain}"/>
                                        <lightning:button value="{!fileWrapper}" label="Delete" onclick="{!c.handleDeleteNew}"/>
                                    </div>
                                </div>
                            </aura:iteration>
                        </div>

<!--                        <div class="preview slds-align_absolute-center" style="width: 200px;">-->
<!--                            -->
<!--                        </div>-->
                    </div>

                </div>
                <div class="slds-card__footer">
                    <lightning:button variant="neutral" label="Cancel" onclick="{!c.handleCancel}"/>
                    <lightning:button variant="brand" label="Save" onclick="{!c.handleSave}"/>
                </div>
            </div>
        </div>
    </div>

    <aura:if isTrue="{!not(empty(v.productError))}">
        <div class="recordError">
                {!v.productError}</div>
    </aura:if>

</aura:component>